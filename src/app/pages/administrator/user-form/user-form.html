<app-alert [message]="alertMessage" [show]="alertShow"></app-alert>

<div class="cliente-wrapper">
  <div class="cliente-card">

    <h2>{{ user.id ? 'Editar Usuario' : 'Nuevo Usuario' }}</h2>

    <div class="form-scroll">

      <div class="input-group" [class.error]="errors.identificationNumber">
        <label>CÃ©dula</label>
        <input 
          [(ngModel)]="user.identificationNumber" 
          maxlength="10" 
          (input)="soloNumeros($event)" 
          (blur)="validateField('identificationNumber')"
          placeholder="Ingrese su cÃ©dula"
        />
        <small class="error-text">{{ errors.identificationNumber }}</small>
      </div>

      <div class="input-group" [class.error]="errors.email">
        <label>Correo</label>
        <input 
          [(ngModel)]="user.email" 
          type="email"
          (blur)="validateField('email')"
          (input)="validateField('email')"
          placeholder="correo@ejemplo.com"
        />
        <small class="error-text">{{ errors.email }}</small>
      </div>

      <div class="input-group" [class.error]="errors.userName">
        <label>Usuario</label>
        <input 
          [(ngModel)]="user.userName" 
          (blur)="validateField('userName')"
          (input)="validateField('userName')"
          placeholder="Nombre de usuario"
        />
        <small class="error-text">{{ errors.userName }}</small>
      </div>

      <div class="input-group" *ngIf="!isEditMode" [class.error]="errors.password">
        <label>ContraseÃ±a</label>
        <div class="password-container">
          <input 
            [type]="showPassword ? 'text' : 'password'" 
            [(ngModel)]="user.password"
            (blur)="validateField('password')"
            (input)="validateField('password')"
            placeholder="MÃ­nimo 8 caracteres"
          />
          <button type="button" class="eye-button" (click)="togglePasswordVisibility('password')">
            {{ showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        <small class="error-text">{{ errors.password }}</small>
        <small class="help-text">Debe tener mÃ­nimo 8 caracteres, 1 mayÃºscula, 1 nÃºmero y 1 carÃ¡cter especial</small>
      </div>

      <!-- Campos de contraseÃ±a ocultos en modo ediciÃ³n hasta que se implemente en el backend -->
      <!-- <div class="input-group" *ngIf="isEditMode" [class.error]="errors.currentPassword">
        <label>ContraseÃ±a actual</label>
        <div class="password-container">
          <input 
            [type]="showCurrentPassword ? 'text' : 'password'" 
            [(ngModel)]="user.currentPassword"
            (blur)="validateField('currentPassword')"
            placeholder="ContraseÃ±a actual"
          />
          <button type="button" class="eye-button" (click)="togglePasswordVisibility('currentPassword')">
            {{ showCurrentPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        <small class="error-text">{{ errors.currentPassword }}</small>
      </div> -->

      <!-- <div class="input-group" *ngIf="isEditMode" [class.error]="errors.newPassword">
        <label>Nueva contraseÃ±a</label>
        <div class="password-container">
          <input 
            [type]="showNewPassword ? 'text' : 'password'" 
            [(ngModel)]="user.newPassword"
            (blur)="validateField('newPassword')"
            (input)="validateField('newPassword')"
            placeholder="Nueva contraseÃ±a"
          />
          <button type="button" class="eye-button" (click)="togglePasswordVisibility('newPassword')">
            {{ showNewPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        <small class="error-text">{{ errors.newPassword }}</small>
        <small class="help-text">Debe tener mÃ­nimo 8 caracteres, 1 mayÃºscula, 1 nÃºmero y 1 carÃ¡cter especial</small>
      </div> -->

      <!-- <div class="input-group" *ngIf="isEditMode" [class.error]="errors.confirmNewPassword">
        <label>Confirmar nueva contraseÃ±a</label>
        <div class="password-container">
          <input 
            [type]="showConfirmPassword ? 'text' : 'password'" 
            [(ngModel)]="user.confirmNewPassword"
            (blur)="validateField('confirmNewPassword')"
            (input)="validateField('confirmNewPassword')"
            placeholder="Confirmar nueva contraseÃ±a"
          />
          <button type="button" class="eye-button" (click)="togglePasswordVisibility('confirmPassword')">
            {{ showConfirmPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        <small class="error-text">{{ errors.confirmNewPassword }}</small>
      </div> -->
      <div class="input-group" [class.error]="errors.roles">
        <label>Rol</label>
        <select 
          [(ngModel)]="user.roles" 
          class="combo-select" 
          [disabled]="loadingRoles"
          (change)="validateField('roles')"
        >
          <option value="">{{ loadingRoles ? 'Cargando roles...' : 'Seleccione un rol' }}</option>
          <option *ngFor="let r of rolesList" [value]="r.name" [title]="r.description">
            {{ r.name }} - {{ r.description }}
          </option>
        </select>
        <small class="error-text">{{ errors.roles }}</small>
      </div>

      <div class="input-group" *ngIf="isEditMode">
        <label>
          <input type="checkbox" [(ngModel)]="user.emailConfirmed" /> Correo confirmado
        </label>
      </div>

      <div class="input-group" *ngIf="isEditMode">
        <label>
          <input type="checkbox" [(ngModel)]="user.isLocked" /> Usuario bloqueado
        </label>
      </div>

    </div>

    <hr>

    <div class="buttons">
      <button class="btn primary" (click)="save()">Guardar</button>
      <button class="btn warn" (click)="close()">Cancelar</button>
    </div>

  </div>
</div>
