<app-alert [message]="alertMessage" [show]="alertShow"></app-alert>

<div class="cliente-wrapper">
  <div class="cliente-card">
    <h2>{{ cliente.clientId ? 'Editar Cliente' : 'Nuevo Cliente' }}</h2>

    <div class="form-scroll">

      <div class="input-group" [class.error]="errors.identificationType" [class.readonly]="!!cliente.clientId">
        <label>Tipo de ID</label>
        <select 
          [(ngModel)]="cliente.identificationType"
          (change)="validateField('identificationType')"
          [disabled]="!!cliente.clientId"
        >
          <option value="">-- Seleccione --</option>
          <option value="CEDULA">Cédula</option>
          <option value="PASAPORTE">Pasaporte</option>
        </select>
        <small class="error-text" *ngIf="!cliente.clientId">{{ errors.identificationType }}</small>
        <small class="help-text" *ngIf="!!cliente.clientId && !errors.identificationType">El tipo de identificación no se puede modificar</small>
      </div>

      <div class="input-group" [class.error]="errors.identificationNumber" [class.readonly]="!!cliente.clientId">
        <label>Cédula / Pasaporte</label>
        <input 
          type="text" 
          [(ngModel)]="cliente.identificationNumber" 
          (input)="soloIdentificacion($event)"
          (blur)="validateField('identificationNumber')"
          [placeholder]="cliente.identificationType === 'CEDULA' ? '10 dígitos (ej: 1234567890)' : cliente.identificationType === 'PASAPORTE' ? '6-9 caracteres (ej: AB123456)' : 'Número de identificación'"
          [maxlength]="cliente.identificationType === 'CEDULA' ? '10' : '9'"
          [disabled]="!!cliente.clientId"
          [readonly]="!!cliente.clientId"
        />
        <small class="error-text" *ngIf="!cliente.clientId">{{ errors.identificationNumber }}</small>
        <small class="help-text" *ngIf="!!cliente.clientId && !errors.identificationNumber">El número de identificación no se puede modificar</small>
      </div>

      <div class="input-group" [class.error]="errors.firstName">
        <label>Nombre</label>
        <input 
          type="text" 
          [(ngModel)]="cliente.firstName" 
          (input)="soloLetras($event, 'firstName')"
          (blur)="validateField('firstName')"
          placeholder="Solo letras (ej: Juan Carlos)"
          maxlength="50"
        />
        <small class="error-text">{{ errors.firstName }}</small>
      </div>

      <div class="input-group" [class.error]="errors.lastName">
        <label>Apellido</label>
        <input 
          type="text" 
          [(ngModel)]="cliente.lastName" 
          (input)="soloLetras($event, 'lastName')"
          (blur)="validateField('lastName')"
          placeholder="Solo letras (ej: Pérez García)"
          maxlength="50"
        />
        <small class="error-text">{{ errors.lastName }}</small>
      </div>

      <div class="input-group" [class.error]="errors.phone">
        <label>Teléfono</label>
        <input 
          type="text" 
          [(ngModel)]="cliente.phone" 
          (input)="soloNumeros($event)"
          (blur)="validateField('phone')"
          placeholder="7-10 dígitos (ej: 0987654321)"
          maxlength="10"
        />
        <small class="error-text">{{ errors.phone }}</small>
      </div>

      <div class="input-group" [class.error]="errors.email">
        <label>Email</label>
        <input 
          type="email" 
          [(ngModel)]="cliente.email" 
          (blur)="validateField('email')"
          (input)="onEmailChange()"
          placeholder="ejemplo@correo.com"
          maxlength="100"
        />
        <small class="error-text">{{ errors.email }}</small>
      </div>

      <div class="input-group" [class.error]="errors.address">
        <label>Dirección</label>
        <input 
          type="text" 
          [(ngModel)]="cliente.address" 
          (blur)="validateField('address')"
          (input)="onAddressChange()"
          placeholder="Mínimo 5 caracteres (ej: Av. Principal 123)"
          minlength="5"
        />
        <small class="error-text">{{ errors.address }}</small>
      </div>

    </div>

    <hr />

    <div class="buttons">
      <button *ngIf="userRole.includes('Administrator')" class="btn primary" (click)="save()">{{ cliente.clientId ? 'Actualizar' : 'Guardar' }}</button>
      <button class="btn warn" (click)="close()">Cancelar</button>
    </div>
  </div>
</div>
